---
title: "Simulating Occupational Mobility with Optimal Transport Theory"
author: Richard Martin
format:
  revealjs:
    smaller: true
    slide-number: true
    scrollable: false
    theme: solarized
    margin: 0
bibliography: references.bib
slide-number: true
incremental: true
widescreen: true
self-contained: true
execute:
  warning: false
  message: false
  echo: false
  error: false
---

```{r, include=FALSE}
library(tidyverse)
library(here)
skills <- read_rds("skills.rds")
results <- read_rds("results.rds")
```

## Introduction

::: {#tbl-ei noc="2021" tbl-cap="EI applications by NOC since January 2025"}
<div style="font-size: 0.9em">
| NOC 2021 (5 digit)                     | \# Clients |
|----------------------------------------|------------|
| Logging machinery operators            | 418        |
| Silviculture and forestry workers      | 339        |
| Chain saw and skidder operators        | 319        |
| Forestry technologists and technicians | 223        |
| Supervisors, logging and forestry      | 108        |
</div>
:::

::: {.noincremental}

-  If I asked you to find alternative occupations for these people, what would you do?
-  My first thought: look at prior transitions out of these occupations.
-  At the 5 digit NOC level, this is not feasible:  Statistics Canada suppression rules. 
-  If we can't observe, simulate!
-  Jumping off point: 2011 NHS and 2021 Census 5 digit NOC proportions, which allows us to observe aggregate change.
:::

---

## Changes in Occupation Proportions

```{r, fig.retina=2}
print(results$source_destination_plot[[1]])
```

------------------------------------------------------------------------

## Changes in Occupation Proportions

```{r, fig.retina=2}
print(results$source_destination_plot[[2]])
```

------------------------------------------------------------------------

## Changes in Occupation Proportions

```{r, fig.retina=2}
print(results$source_destination_plot[[3]])
```

------------------------------------------------------------------------

## Changes in Occupation Proportions

```{r, fig.retina=2}
print(results$source_destination_plot[[4]])
```

------------------------------------------------------------------------

## Changes in Occupation Proportions

-   Greatest shifts in the occupation distribution occur between the age brackets 15-24 and 25-34: for many individuals this is when the make the transition from "job" to "career", likely after attaining some post secondary education.
-   Both the *number* of occupations with a change in proportion greater than .005, as well as the *scale* of the changes in proportion diminish for older age brackets.

------------------------------------------------------------------------

## Cost Minimizing Occupational Mobility

-   To reiterate, we can not directly observe career changes, but we can infer they must occur based on shifts in occupational proportions between the 2011 NHS and 2021 Census.
-   There is an infinite set of occupational changes that would be consistent with both the initial and subsequent proportions.
-   Below we make use of the shortsimplex method [@gottschlich2014shortlist] to the optimal transport problem to solve for the occupational transitions which minimizes "cost".

------------------------------------------------------------------------

## Example

-   Suppose goal is to end up with 4 evenly sized piles of dirt.
-   Initially, the piles are arranged in a unit square, and have masses 1kg, 2kg, 3kg, 4kg.
-   Cost is defined to be $\sum mass \times distance$.
-   What is least costly way to end up with 4 piles of 2.5kg?

::: fragment
```{r}
#| out.width: 50%
#| out.height: 50%
knitr::include_graphics(here("images","no_arrows.svg"))
```
:::

------------------------------------------------------------------------

## Solution {.columns}

::: {.column width="50%"}
```{r}
#| out.width: 100%
#| out.height: 100%
knitr::include_graphics(here("images","with_arrows.svg"))
```
:::

::: {.column width="50%"}
-   Move .5kg 1 unit of distance.
-   Move 1kg $\sqrt2$ units of distance (hypotenuse)
-   Move .5kg 1 unit of distance.
-   $\min(cost)=1+\sqrt2$.
:::

------------------------------------------------------------------------

## How is this related to labour market?

-   Rather than piles of dirt, consider 512 "piles" of workers.
-   Specifically, consider the NOC proportions of those 15-24 in 2011: this corresponds to the size of the original "piles".
-   Likewise, the NOC proportions of those 25-34 in 2021 are the desired "piles".
-   There is an infinite number of ways to move workers to attain the desired piles.
-   The optimal transport problem picks the least costly solution from the set of possible solutions.
-   The solution provides the lower bound of (costly) occupational transitions.

------------------------------------------------------------------------

## Distance between occupations

-   We use 161 occupational characteristics from ONET to measure the distance between occupations.
-   Principal component analysis is used to reduce the dimensionality of the data.
-   For our distance metric we calculate the Euclidean distance on the first 10 principal components.

------------------------------------------------------------------------

## Screeplot

```{r, fig.retina=2}
eig <- factoextra::get_eig(skills[["onet_pca"]]) |>
head(n=10)
eig$Dim <- seq_len(nrow(eig))

ggplot(eig, aes(x = factor(Dim))) +
geom_bar(aes(y = variance.percent), stat = "identity") +
geom_line(aes(y = cumulative.variance.percent), size = 0.8, group = 1) +
geom_point(aes(y = cumulative.variance.percent)) +
scale_y_continuous(
name = "Individual % variance",
sec.axis = sec_axis(~ ., name = "Cumulative % variance")
) +
labs(title="First 10 components capture over 80% of the variability", 
     x = "Principal Component") +
theme_minimal()
```

------------------------------------------------------------------------

## Distances Between Occupations {.columns}

::: {.column width="50%"}
```{r, fig.height=5, fig.width=5, cache=TRUE}
heatmaply::heatmaply(
  skills[["skills_noc_dist"]],
  show_dendrogram = c(FALSE, FALSE),
  showticklabels = c(FALSE, FALSE)
)|>
  plotly::layout(autosize = TRUE) |>
  plotly::config(responsive = TRUE)
```
:::

::: {.column width="50%"}
-   Along the diagonal the distance is zero between an occupation and itself.
-   Clusters of occupations with similar skill profiles are located in darker rectangles along the diagonal.
:::

------------------------------------------------------------------------

## Transitions: 15 to 24 years -\> 25 to 34 years

<video width="800" controls>

<source src="15_to_24_years -> 25_to_34_years.mp4" type="video/mp4">

Your browser does not support the video tag. </video>

------------------------------------------------------------------------

## Transitions: 25 to 34 years -\> 35 to 44 years

<video width="800" controls>

<source src="25_to_34_years -> 35_to_44_years.mp4" type="video/mp4">

Your browser does not support the video tag. </video>

------------------------------------------------------------------------

## Transitions: 35 to 44 years -\> 45 to 54 years

<video width="800" controls>

<source src="35_to_44_years -> 45_to_54_years.mp4" type="video/mp4">

Your browser does not support the video tag. </video>

------------------------------------------------------------------------

## Transitions: 45 to 54 years -\> 55 to 64 years

<video width="800" controls>

<source src="45_to_54_years -> 55_to_64_years.mp4" type="video/mp4">

Your browser does not support the video tag. </video>

------------------------------------------------------------------------

## TEER Summaries

-  The animations above made use of Multidimensional scaling (MDS) of the skill distances between occupations. 
-  Because distances are based on 10D data (the first 10 principal components), the 2D "locations" of the origin and destination occupations (where the bubbles start and end) should be taken with a grain of salt. 
-  If we aggregate the flows to the TEER level, we can visualize using (static) alluvial plots.

------------------------------------------------------------------------

## First transition

```{r, fig.retina=2}
results$teer_alluvium_plot[[1]]
```

------------------------------------------------------------------------

## Second transition

```{r, fig.retina=2}
results$teer_alluvium_plot[[2]]
```

------------------------------------------------------------------------

## Third transition

```{r, fig.retina=2}
results$teer_alluvium_plot[[3]]
```

------------------------------------------------------------------------

## Forth transition

```{r, fig.retina=2}
results$teer_alluvium_plot[[4]]
```

------------------------------------------------------------------------

## References

::: {.references}
:::


